{"version":3,"file":"webpack.config.js","sourceRoot":"","sources":["webpack.config.ts"],"names":[],"mappings":"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","sourcesContent":["const path = require(\"path\");\nconst autoprefixer = require(\"autoprefixer\");\nconst htmlWebpackPlugin = require(\"html-webpack-plugin\");\nconst cleanWebpackPlugin = require(\"clean-webpack-plugin\");\nconst UglifyJsPlugin = require(\"uglifyjs-webpack-plugin\");\nconst MiniCssExtractPlugin = require(\"mini-css-extract-plugin\");\nconst OptimizeCSSAssetsPlugin = require(\"optimize-css-assets-webpack-plugin\");\nconst CompressionPlugin = require(\"compression-webpack-plugin\");\nimport { ConfigurationManager } from \"@nivinjoseph/n-config\";\n\nconst env = ConfigurationManager.getConfig<string>(\"env\");\nconsole.log(\"WEBPACK ENV\", env);\n\nconst isDev = env === \"dev\";\n\nconst moduleRules: Array<any> = [\n    {\n        test: /\\.(scss|sass)$/,\n        use: [{\n            loader: isDev ? \"style-loader\" : MiniCssExtractPlugin.loader\n        }, {\n            loader: \"css-loader\" // translates CSS into CommonJS\n        }, {\n            loader: \"postcss-loader\", // postcss\n            options: {\n                plugins: () => [\n                    require(\"postcss-flexbugs-fixes\"),\n                    autoprefixer({\n                        browsers: [\n                            \">1%\",\n                            \"not ie < 9\"\n                        ],\n                        flexbox: \"no-2009\"\n                    })\n                ]\n            }\n        }, {\n            loader: \"sass-loader\" // compiles Sass to CSS -> depends on node-sass\n        }]\n    },\n    {\n        test: /\\.css$/,\n        use: [{\n            loader: isDev ? \"style-loader\" : MiniCssExtractPlugin.loader\n        }, {\n            loader: \"css-loader\" // translates CSS into CommonJS\n        }]\n    },\n    {\n        test: /\\.svg$/,\n        use: [\n            isDev ? \"file-loader\" : {\n                loader: \"url-loader\",\n                options: {\n                    limit: 9000,\n                    fallback: \"file-loader\"\n                }\n            }\n        ]\n    },\n    {\n        test: /\\.(png|jpg|jpeg|gif)$/,\n        use: [\n            isDev ? \"file-loader\" : {\n                loader: \"url-loader\",\n                options: {\n                    limit: 9000,\n                    fallback: \"file-loader\"\n                }\n            },\n            {\n                loader: \"image-webpack-loader\",\n                options: {\n                    bypassOnDebug: true,\n                }\n            }\n        ]\n    },\n    {\n        test: /\\.(woff|woff2|eot|ttf|otf)$/,\n        use: [\n            isDev ? \"file-loader\" : {\n                loader: \"url-loader\",\n                options: {\n                    limit: 9000,\n                    fallback: \"file-loader\"\n                }\n            }\n        ]\n    },\n    {\n        test: /\\.(html)$/,\n        use: {\n            loader: \"html-loader\",\n            options: {\n                attrs: [\"img:src\", \"use:xlink:href\"]\n            }\n        }\n    }\n];\n\nconst plugins = [\n    new cleanWebpackPlugin([\"src/www\"]),\n    new htmlWebpackPlugin({\n        template: \"src/app.html\",\n        filename: \"index.html\",\n        hash: true\n    }),\n    {\n        apply: function (compiler: any)\n        {\n            compiler.hooks.compilation.tap(\"ConfigPlugin\", (compilation: any) =>\n            {\n                compilation.hooks.htmlWebpackPluginAfterHtmlProcessing.tapAsync(\n                    \"ConfigPlugin\",\n                    (data: any, cb: any) =>\n                    {\n                        data.html = data.html.replace(\"<body>\",\n                            `\n                                <body>\n                                <script>\n                                    window.config = \"${Buffer.from(JSON.stringify(ConfigurationManager.configObject), \"utf8\").toString(\"hex\")}\";\n                                </script>\n                            `);\n\n                        cb(null, data);\n                    }\n                );\n            });\n        }\n    }\n];\n\nif (!isDev)\n{\n    moduleRules.push({\n        test: /\\.js$/,\n        use: {\n            loader: \"babel-loader\",\n            options: {\n                presets: [[\"@babel/preset-env\", {\n                    debug: false,\n                    targets: {\n                        // browsers: [\"> 1%\", \"Chrome >= 41\"],\n                        chrome: \"41\" // this is what googles web crawler uses\n                    },\n                    useBuiltIns: \"entry\",\n                    forceAllTransforms: true,\n                    modules: \"commonjs\"\n                }]]\n            }\n        }\n    });\n    plugins.push(...[\n        new MiniCssExtractPlugin({\n            filename: \"client.bundle.css\"\n        }),\n        new CompressionPlugin({\n            test: /\\.(js|css|svg)$/\n        })\n    ]);\n}\n\nmodule.exports = {\n    mode: isDev ? \"development\" : \"production\",\n    target: \"web\",\n    entry: [\"./src/app.js\"],\n    output: {\n        filename: \"app.bundle.js\",\n        path: path.resolve(__dirname, \"src/www\"),\n        publicPath: \"/\"\n    },\n    devtool: isDev ? \"inline-source-map\" : \"source-map\",\n    optimization: {\n        minimizer: [\n            new UglifyJsPlugin({\n                sourceMap: true,\n                uglifyOptions: {\n                    keep_classnames: true,\n                    keep_fnames: true,\n                    safari10: true\n                }\n            }),\n            new OptimizeCSSAssetsPlugin({})\n        ]\n    },\n    module: {\n        rules: moduleRules\n    },\n    plugins: plugins\n};"]}